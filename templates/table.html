{% extends 'base.html' %}
{% block title%}Склад{% endblock %}
{% block body%}
<table>
    <thead>
      <tr>
        <th scope="col" class="id">ID</th> 
        <th scope="col" class="state">Статус</th>
        <th scope="col" class="size">Размер</th>
        <th scope="col" class="adres">Адрес</th>
        <th scope="col" class="client">Клиент</th>
        <th scope="col" class="phone-number">Телефон</th>
        <th scope="col" class="courier">Курьер</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
</table>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    const tableTbody = document.querySelector("table > tbody")
    const token = localStorage.getItem('token');
    console.log(token)
    axios.get(
        'http://127.0.0.1:8000/api/box',
        {
            headers: {
                'Content-Type': 'multipart/form-data',
                'Authorization': 'Bearer ' + token
            },
        },
    )
        .then(response => {
            if (response.status === 200) {
                console.log(response.data);
                const data = response.data
                for (const item of data) {
                let className;
                if (item.status === 'Завершен') {
                    className = 'state-done';
                } else if (item.status === 'Доставка') {
                    className = 'state-delivery';
                } else {
                    className = 'state-new';
                }
                const row = document.createElement('tr');
                    row.innerHTML = `
                        <th scope="row" class="id">${item.id}</th>
                        <td class="state"> <div class=${className}>${item.status}</div> </td>
                        <td class="size">${item.size}</td>
                        <td class="adres">${item.address}</td>
                        <td class="client">${item.client}</td>
                        <td class="phone-number">${item.phone}</td>
                        <td class="courier">${item.courier}</td>
                    `;
                    tableTbody.appendChild(row);
                }
        } 
        })
        .catch(error => {
        console.log(error.response.data);
        console.log();

        if (error.response.data.detail == 'Unauthorized'){
            window.location.href = '/login';
        }
        });
    </script>
{% endblock %} 